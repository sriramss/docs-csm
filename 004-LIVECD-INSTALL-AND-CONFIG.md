# LiveCD Installation and Configuration

## If you've arrived here with files from [002 LiveCD Setup](002-LIVECD-SETUP.md) then you can skip to [Manual Check 1: Validate the LiveCD platform](#manual-check-1-validate-the-livecd-platform)

This page will assist you with configuring and activating your booted LiveCD.

### Manual Step 1: Interfaces

> Set up variables for lan0 configuration

```bash
pit:~ # site_ip=172.30.XXX.YYY/20
pit:~ # site_gw=172.30.48.1
pit:~ # site_dns=172.30.84.40
pit:~ # site_nic=p1p2
```

- `site_nic` The interface that is directly attached to the site network on ncn-m001.  This should not be lan0.
- `site_ip` The IP address and netmask in CIDR notation that is assigned to the site connection on ncn-m001.  NOTE:  This is NOT just the network, but also the IP address.
- `site_gw` The gateway address for the site network.  This will be used to set up the default gateway route on ncn-m001.
- `site_dns` ONE of the site DNS servers.   The script does not currently handle setting more than one IP address here.

#### Setup the Site-Link Connection(s)

External, direct access.

> **`PREFERRED`** use the generated files from your system inputs...
```bash
pit:~ # system_name=bigbird
pit:~ # cp /var/www/ephemeral/prep/${system_name}/cpt-files/ /etc/sysconfig/network/
pit:~ # wicked ifreload lan0
```

> **`MANUAL`** without CPT files generated by CSI...
```bash
pit:~ # /root/bin/csi-setup-lan0.sh $site_ip $site_gw $site_dns $site_nic
```

If there's an IP showing for `ip a s lan0` then you could exit your CONSOLE and return with an SSH connection (if you prefer).

#### Setup Internal Connections

Now reload the other configurations:

> **`PREFERRED`** use the generated files from your system inputs...
```bash
pit:~ # wicked ifreload all
```

> **`MANUAL`** without CPT files generated by CSI...
```bash
pit:~ # /root/bin/csi-setup-vlan002.sh $nmn_cidr
pit:~ # /root/bin/csi-setup-vlan004.sh $hmn_cidr
pit:~ # /root/bin/csi-setup-vlan007.sh $can_cidr
```

### Manual Check 1: Validate the LiveCD platform.

Check that IPs are set for each interface:

```bash
pit:~ # csi pit validate --network
```

### Manual Step 2: Services

Copy the config files generated earlier by `csi config init` into /etc/dnsmasq.d and /etc/conman.conf.
```bash
cp /var/www/ephemeral/prep/${system_name}/dnsmasq.d/* /etc/dnsmasq.d
cp /var/www/ephemeral/prep/${system_name}/conman.conf /etc/conman.conf
cp /var/www/ephemeral/prep/${system_name}/basecamp/* /var/www/ephemeral/configs/
systemctl restart conman
systemctl restart dnsmasq
systemctl start basecamp
systemctl start nexus
```

Start and configure NTP on the LiveCD for a fallback/recovery server:

```bash
pit:~ # /root/bin/configure-ntp.sh
```

### Manual Check 2: Validate the Services

Now verify service health:
- dnsmasq, basecamp, and nexus should report HEALTHY and running.
- No podman container(s) should be dead.

```bash
csi pit validate --services
```

> - If basecamp is dead, restart it with `systemctl restart basecamp`.
> - If dnsmasq is dead, restart it with `systemctl restart dnsmasq`.
> - If nexus is dead, restart it with `systemctl restart nexus`.

You should see two containers: nexus and basecamp

```
CONTAINER ID  IMAGE                                         COMMAND               CREATED     STATUS         PORTS   NAMES
496a2ce806d8  dtr.dev.cray.com/metal/cloud-basecamp:latest                        4 days ago  Up 4 days ago          basecamp
6fcdf2bfb58f  docker.io/sonatype/nexus3:3.25.0              sh -c ${SONATYPE_...  4 days ago  Up 4 days ago          nexus
```

### Manual Check 3: Verify Outside Name Resolution

> **`SKIP IF AIRGAP/OFFLINE`** - offline installs should skip this check entirely.

Verify you can ping quad9, or Google's, or your IT/site's DNS servers:

```bash
ping 9.9.9.9
ping 8.8.8.8
```

Now is a good time to also verify your local site docker registry, and RPM repository connectivity as well.

> **`INTERNAL USE`** These URLs are important for internal testing and have no use when used outside of CRAY-HPE Labs. This is just provided as an example of relevant endpoints.

You should be able to resolve outside services like arti.dev.cray.com.

```bash
# Artifactory (both are used; one is in the works of replacing the other)
ping arti.dev.cray.com
ping car.dev.cray.com

# Docker Registry
ping dtr.dev.cray.com
```

### Next: Deploy the NCNs

Now you can now pass GO, collect $200, and begin the [NCN Deploy](005-NCN-DEPLOY.md) page...
